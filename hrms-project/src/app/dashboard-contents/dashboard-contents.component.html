

<div class="email_div"  >
  <mat-icon>chevron_left</mat-icon>

  <div class="hover-content">
    <div class="side_sec" (click)="openAddFieldsModal()" >
   <h6 class="text-center"> <mat-icon>dataset</mat-icon></h6>
    <h2 class="text-center">Choose Branch</h2>
    </div>
  </div>
</div>


        
          



<div class="container" >
  <!-- Modal Popup for selected approval details -->
  <div *ngIf="isAddFieldsModalOpen" class="modal">

    <div class="modal-content">
      <span class="close pull-right" (click)="closemarketModal()">&times;</span>
   
      <label>Choose Branch</label>
        <div class="custom-sel">
          <select class=" form-control" [(ngModel)]="selectedBranchIdhol" (change)="onBranchChange($event)">
            <option value="" disabled selected>Select Branch</option>
            <option *ngFor="let branch of branches" [value]="branch.id">
              {{ branch.branch_name }}

              
            </option>
          </select>
        </div>
    

    </div>
  </div>
 
    <div class="comapny_section" *ngIf="userDetails">
        <div class="content_sec">
   
        <h3 class="userdisname">{{userDetails.username}}</h3>
        <div class="row">
            <div class="col-md-10 col-8">
                <h3 class="mb-5">{{ currentGreeting }}</h3>

            </div>
            <div class="col-md-2 col-4">
                <button type="button" class="btn-ess btn pull-right" (click)="EssUser()">
                    <span class="animated-text">
                   
                      Ess Profile
                    </span>
                  </button>
                  
                              </div>
        </div>
            
        <div class="card-list">  

            <div class="row">
                <div class="col-md-3 col-12">
                    <div class="card blue" routerLink="/main-sidebar/settings/branch-master">
                        <div class="title">Branches <span class="pull-right"> <mat-icon>apartment
                        </mat-icon></span></div>
                       
                        <div class="value">{{branchCount}}</div>
                        <div class="stat"></div>
                    </div>
                </div>
                <div class="col-md-3 col-12">
                    <div class="card green" routerLink="/main-sidebar/sub-sidebar/department-master">
                        <div class="title">Departments <span class="pull-right"> <mat-icon>account_tree</mat-icon></span></div>
                        <i class="zmdi zmdi-upload"></i>
                        <div class="value">{{departmentCount}}</div>
                        <div class="stat"></div>
                    </div>
                </div>
                <div class="col-md-3 col-12">
                    <div class="card orange"  routerLink="/main-sidebar/sub-sidebar/catogary-master">
                        <div class="title">Categories <span class="pull-right"> <mat-icon>category</mat-icon></span></div>
                        <i class="zmdi zmdi-download"></i>
                        <div class="value">{{categoriesCount}}</div>
                        <div class="stat"></div>
                    </div>
                </div>
                <div class="col-md-3 col-12">
                    <div class="card red" routerLink="/main-sidebar/sub-sidebar/designation-master">
                        <div class="title">Designations <span class="pull-right"> <mat-icon>badge</mat-icon></span></div>
                        <i class="zmdi zmdi-download"></i>
                        <div class="value">{{designationsCount}}</div>
                        <div class="stat"></div>
                    </div>
                </div>
            </div>
        </div>

        
    </div>

    <div class="content_sec_last">

    <div class="row mt-5">
        <div class="col-md-4">
            <div class="dash_holidays">
              <div class="row">
                <div class="col-md-5">
                  <h6>Holidays</h6>
                </div>
                <div class="col-md-7">
                  <!-- <div class="custom-sel pull-right">
                    <select class="drop_list form-control" [(ngModel)]="selectedBranchIdhol" (change)="onBranchChange($event)">
                      <option value="" disabled selected>Select Branch</option>
                      <option *ngFor="let branch of branches" [value]="branch.id">
                        {{ branch.branch_name }}

                        
                      </option>
                    </select>
                  </div> -->
                </div>
              </div>
          
              <div *ngIf="selectedBranchHolidays.length === 0" class="mt-3">
                <p>No holidays available for the selected branch.</p>
              </div>
          
              <div *ngFor="let holiday of selectedBranchHolidays"  class="row mt-3">
                <div class="col-md-3">
                  <div class="holi_date_sec">
                    <h2>{{ getDate(holiday.start_date) }} <br><span>{{ getMonth(holiday.start_date) }}</span></h2>
                  </div>
                </div>
                <div class="col-md-9">
                  <h5 class="mt-2">{{ holiday.description }}</h5>
                  <h4>{{ getDay(holiday.start_date) }}</h4>
                </div>
              </div>
            </div>

            <div class="dash_announcements mt-4">
              <div class="row align-items-center mb-3">
                <div class="col-md-12">
                  <h6> Announcements</h6>
                </div>
                
              </div>
        
              <div *ngIf="selectedBranchAnnouncement.length === 0" class="no-announcements">
                <p>No announcements available for this branch.</p>
              </div>
        
              <div class="row">
                <div class="col-md-12 mb-4" *ngFor="let announcement of selectedBranchAnnouncement">
                  <div class="announcement-card">
                    <div class="announcement-header">
                      <mat-icon class="announce-icon">campaign</mat-icon>
                      <h5>{{ announcement.title }}</h5>
                    </div>
                    <p class="message">{{ announcement.message }}</p>
        
                    <div class="date-range">
                      <mat-icon>event</mat-icon>
                      <span>{{ announcement.schedule_at | date: 'MMM d, y, h:mm a' }}</span>
                      <span> ‚Üí {{ announcement.expires_at | date: 'MMM d, y, h:mm a' }}</span>
                    </div>
        
                    <div class="options mt-2">
                      <span *ngIf="announcement.send_email" class="badge email">üìß Email Sent</span>
                      <span *ngIf="announcement.is_sticky" class="badge sticky">üìå Sticky</span>
                    </div>
        
                    <div *ngIf="announcement.attachment" class="mt-2">
                      <a [href]="announcement.attachment" target="_blank" class="view-attachment">
                        <mat-icon>attach_file</mat-icon> View Attachment
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
          </div>
          

          <div class="col-md-8">
            <div class="dash_projects ">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6> Projects</h6>
              </div>
        
              <!-- Empty State -->
              <div *ngIf="selectedBranchProjects.length === 0" class="empty-state text-center">
                <img src="assets/images/no-data.svg" width="150" alt="No projects" class="mb-3" />
                <h5>No active projects available for this branch.</h5>
              </div>
        
              <!-- Project Cards -->
              <div class="row">
                <div class="col-md-6 col-lg-6 mb-4" *ngFor="let project of selectedBranchProjects">
                  <div class="project-card">
<div class="project-header">
  <h4 class="project-title">{{ project.title }}</h4>

  <span
    class="status-badge"
    [ngClass]="{
      'status-new': project.status === 'new',
      'status-active': project.status === 'active',
      'status-completed': project.status === 'completed'
    }"
  >
    {{ project.status | titlecase }}
  </span>
</div>

        
                    <div class="project-body">
                      <p>{{ project.description }}</p>
        
<!-- üìÖ Project Dates -->
<div class="project-dates mb-3">
  <div class="date-item">
    <mat-icon>event</mat-icon>
    <span><strong>Start:</strong> {{ project.start_date | date:'mediumDate' }}</span>
  </div>

  <div class="date-item">
    <mat-icon>event_available</mat-icon>
    <span><strong>End:</strong> {{ project.end_date | date:'mediumDate' }}</span>
  </div>
</div>
        
<!-- üìé Document -->
<div *ngIf="project.document" class="project-document mb-3">
  <a [href]="project.document" target="_blank" class="project-link">
    <mat-icon>insert_drive_file</mat-icon>
    <span>View Document</span>
  </a>
</div>
        
<!-- üßë‚Äçüíº Project Managers & Members -->
<div class="project-team mt-3 d-flex gap-4 flex-wrap">

  <!-- Managers -->
  <div class="team-block">
    <h6>
      <mat-icon>manage_accounts</mat-icon> Managers
    </h6>
    <div class="avatar-group">
      <span *ngFor="let manager of project.managers" class="avatar">
        {{ manager }}
      </span>
    </div>
  </div>

  <!-- Members -->
  <div class="team-block">
    <h6>
      <mat-icon>group</mat-icon> Members
    </h6>
    <div class="avatar-group">
      <span *ngFor="let member of project.members" class="avatar member-avatar">
        {{ member }}
      </span>
    </div>
  </div>

</div>

        
                      <!-- ‚úÖ Tasks -->
<div *ngIf="project.tasks && project.tasks.length > 0" class="task-list mt-4">
  <h6><mat-icon>list</mat-icon> Tasks</h6>

  <div *ngFor="let task of project.tasks" class="task-card">

    <!-- üîπ Clickable Header -->
    <div
      class="task-header d-flex justify-content-between align-items-center"
      (click)="toggleTask(task.id)"
    >
      <h5>{{ task.title }}</h5>

      <div class="d-flex align-items-center gap-2">
        <span
          class="task-status"
          [ngClass]="{
            'to_do': task.status === 'to_do',
            'in_progress': task.status === 'in_progress',
            'done': task.status === 'done'
          }"
        >
          {{ task.status | titlecase }}
        </span>

        <mat-icon class="toggle-icon">
          {{ expandedTaskId === task.id ? 'expand_less' : 'expand_more' }}
        </mat-icon>
      </div>
    </div>

    <!-- üîΩ Expandable Content -->
    <div
      class="task-body"
      *ngIf="expandedTaskId === task.id"
    >
      <p>{{ task.description }}</p>

      <div class="task-dates">
        <span><strong>Start:</strong> {{ task.start_date | date:'mediumDate' }}</span>
        <span><strong>End:</strong> {{ task.end_date | date:'mediumDate' }}</span>
      </div>

      <!-- üë§ Task Managers -->
      <div class="task-team mt-2">
        <small><mat-icon>manage_accounts</mat-icon> Task Managers</small>
        <div class="avatar-group small">
          <span *ngFor="let tm of task.task_managers" class="avatar small-avatar">
            {{ tm }}
          </span>
        </div>

        <small class="mt-2"><mat-icon>group</mat-icon> Task Members</small>
        <div class="avatar-group small">
          <span
            *ngFor="let mem of task.task_members"
            class="avatar small-avatar member-avatar"
          >
            {{ mem }}
          </span>
        </div>
      </div>
    </div>

  </div>
</div>

                    </div>
                  </div>
                </div>
              </div>
            </div>


            <div class="dash_holidays mt-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="fw-bold">üè¢ Company Policies</h6>
                <span class="text-muted small"
                  >Total Policies: {{ selectedBranchPolicies.length }}</span
                >
              </div>
            
              <!-- ‚úÖ Policy Cards -->
              <div class="row g-4">
                <div
                  class="col-md-12 col-lg-12"
                  *ngFor="let policy of selectedBranchPolicies"
                >
                 <div class="policy-card">

                    <!-- Header -->
                    <div class="d-flex justify-content-between align-items-start mb-2">
                      <h5 class="fw-semibold text-primary">{{ policy.title }}</h5>
                      <!-- <span
                        class="badge bg-success"
                        *ngIf="policy.branch"
                        >{{ policy.branch }}</span
                      > -->
                    </div>
            
                    <!-- Description -->
                    <p class="text-muted small mb-3" style="min-height: 50px;">
                      {{ policy.description }}
                    </p>
            
                    <!-- Department & Category -->
                    <div class="d-flex flex-wrap gap-2 mb-3">
                      <span class="badge bg-light text-dark border">
                        <mat-icon class="me-1" style="font-size: 14px;">groups</mat-icon>
                        {{ policy.department || 'N/A' }}
                      </span>
                      <span class="badge bg-light text-dark border">
                        <mat-icon class="me-1" style="font-size: 14px;">category</mat-icon>
                        {{ policy.category || 'N/A' }}
                      </span>
                    </div>
            
                    <!-- Footer -->
                    <div
                      class="d-flex justify-content-between align-items-center border-top pt-3"
                    >
                      <small class="text-secondary">
                        <mat-icon style="font-size: 14px;" class="me-1">calendar_today</mat-icon>
                        {{ policy.created_at | date: 'mediumDate' }}
                      </small>
            
                      <div *ngIf="policy.policy_file">
                        <a
                          [href]="policy.policy_file"
                          target="_blank"
                          class="btn btn-sm btn-outline-primary d-flex align-items-center"
                        >
                          <mat-icon style="font-size: 16px;" class="me-1">description</mat-icon>
                          View
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            
              <!-- üö´ No Policies -->
              <div
                class="text-center text-muted py-5"
                *ngIf="selectedBranchPolicies.length === 0"
              >
                <mat-icon style="font-size: 40px; color: #aaa;">policy</mat-icon>
                <h6 class="mt-2">No policies available for the selected branch.</h6>
              </div>
            </div>
            

           
          </div>
          
    </div>

<!-- Announcements Section -->
<div class="row mt-5">
  <div class="col-md-12">
   
  </div>
</div>


<!-- üåü Projects Section -->
<div class="row mt-5">
  <div class="col-md-12">
  
  </div>
</div>



    </div>
        </div>
        

        </div>


      
    


     <!-- Full-Screen Loader -->
     <div class="loader-container" [class.show]="isLoadingEss">
      <div class="loader"></div>
    </div>