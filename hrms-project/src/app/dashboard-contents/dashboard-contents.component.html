
<div class="email_div"  >
  <mat-icon>chevron_left</mat-icon>

  <div class="hover-content">
    <div class="side_sec" (click)="openAddFieldsModal()" >
   <h6 class="text-center"> <mat-icon>dataset</mat-icon></h6>
    <h2 class="text-center">Choose Branch</h2>
    </div>
  </div>
</div>


        
          



<div class="container" >
  <!-- Modal Popup for selected approval details -->
  <div *ngIf="isAddFieldsModalOpen" class="modal">

    <div class="modal-content">
      <span class="close pull-right" (click)="closemarketModal()">&times;</span>
   
      <label>Choose Branch</label>
        <div class="custom-sel">
          <select class=" form-control" [(ngModel)]="selectedBranchIdhol" (change)="onBranchChange($event)">
            <option value="" disabled selected>Select Branch</option>
            <option *ngFor="let branch of branches" [value]="branch.id">
              {{ branch.branch_name }}

              
            </option>
          </select>
        </div>
    

    </div>
  </div>
 
    <div class="comapny_section" *ngIf="userDetails">
        <div class="content_sec">
   
        <h3 class="userdisname">{{userDetails.username}}</h3>
        <div class="row">
            <div class="col-md-10 col-8">
                <h3 class="mb-5">{{ currentGreeting }}</h3>

            </div>
            <div class="col-md-2 col-4">
                <button type="button" class="btn-ess btn pull-right" (click)="EssUser()">
                    <span class="animated-text">
                   
                      Ess Profile
                    </span>
                  </button>
                  
                              </div>
        </div>
            
        <div class="card-list">  

            <div class="row">
                <div class="col-md-3 col-12">
                    <div class="card blue" routerLink="/main-sidebar/settings/branch-master">
                        <div class="title">Branches <span class="pull-right"> <mat-icon>apartment
                        </mat-icon></span></div>
                       
                        <div class="value">{{branchCount}}</div>
                        <div class="stat"></div>
                    </div>
                </div>
                <div class="col-md-3 col-12">
                    <div class="card green" routerLink="/main-sidebar/sub-sidebar/department-master">
                        <div class="title">Departments <span class="pull-right"> <mat-icon>account_tree</mat-icon></span></div>
                        <i class="zmdi zmdi-upload"></i>
                        <div class="value">{{departmentCount}}</div>
                        <div class="stat"></div>
                    </div>
                </div>
                <div class="col-md-3 col-12">
                    <div class="card orange"  routerLink="/main-sidebar/sub-sidebar/catogary-master">
                        <div class="title">Categories <span class="pull-right"> <mat-icon>category</mat-icon></span></div>
                        <i class="zmdi zmdi-download"></i>
                        <div class="value">{{categoriesCount}}</div>
                        <div class="stat"></div>
                    </div>
                </div>
                <div class="col-md-3 col-12">
                    <div class="card red" routerLink="/main-sidebar/sub-sidebar/designation-master">
                        <div class="title">Designations <span class="pull-right"> <mat-icon>badge</mat-icon></span></div>
                        <i class="zmdi zmdi-download"></i>
                        <div class="value">{{designationsCount}}</div>
                        <div class="stat"></div>
                    </div>
                </div>
            </div>
        </div>

        
    </div>

<div class="content_sec_last">
  <div class="row mt-5 g-4">
    <!-- Left Column: Holidays + Announcements -->
    <div class="col-lg-4">
      <!-- Holidays -->
      <div class="dash_holidays mb-4">
        <h6 class="section-title mb-4">Holidays</h6>

        <div *ngIf="selectedBranchHolidays.length === 0" class="text-center py-4 text-muted">
          <p>No holidays available for the selected branch.</p>
        </div>

        <div *ngFor="let holiday of selectedBranchHolidays" class="holiday-item mb-4">
          <div class="d-flex align-items-center gap-3">
            <div class="holi_date_sec text-center text-white">
              <h2 class="mb-0">{{ getDate(holiday.start_date) }}</h2>
              <span class="month">{{ getMonth(holiday.start_date) }}</span>
            </div>
            <div>
              <h5 class="mb-1 fw-semibold">{{ holiday.description }}</h5>
              <p class="mb-0 text-muted small">{{ getDay(holiday.start_date) }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Announcements -->
      <div class="dash_announcements">
        <h6 class="section-title mb-4">Announcements</h6>

        <div *ngIf="selectedBranchAnnouncement.length === 0" class="text-center py-5 text-muted">
          <p>No announcements available for this branch.</p>
        </div>

        <div class="announcement-list">
          <div class="announcement-card mb-3" *ngFor="let announcement of selectedBranchAnnouncement">
            <div class="d-flex align-items-start gap-3">
              <mat-icon class="announce-icon text-primary">campaign</mat-icon>
              <div class="flex-grow-1">
                <h5 class="fw-semibold mb-1">{{ announcement.title }}</h5>
                <p class="message text-muted mb-2">{{ announcement.message }}</p>

<div class="d-flex align-items-center gap-2 text-muted small mb-2">
  <mat-icon fontSize="small">event</mat-icon>
  <span>{{ announcement.schedule_at | date: 'MMM d, y, h:mm a' }}</span>
  <span>‚Üí</span>
  <span>{{ announcement.expires_at | date: 'MMM d, y, h:mm a' }}</span>
</div>

<div class="d-flex flex-wrap gap-2 align-items-center">
  <span *ngIf="announcement.send_email" class="badge email">üìß Email Sent</span>
  <span *ngIf="announcement.is_sticky" class="badge sticky">üìå Sticky</span>
  
  <a *ngIf="announcement.attachment" 
     [href]="announcement.attachment" 
     target="_blank"
     class="view-attachment ms-auto text-primary small d-flex align-items-center gap-1">
    <mat-icon fontSize="small">attach_file</mat-icon> 
    View Attachment
  </a>
</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column: Projects + Policies -->
    <div class="col-lg-8">
      <!-- Projects -->
      <div class="dash_projects mb-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h6 class="section-title">Projects</h6>
          <span class="text-muted small">{{ selectedBranchProjects.length }} Active</span>
        </div>

        <div *ngIf="selectedBranchProjects.length === 0" class="text-center py-5">
          <img src="assets/images/no-data.svg" width="120" alt="No projects" class="mb-3 opacity-50" />
          <h6 class="text-muted">No active projects available for this branch.</h6>
        </div>

        <div class="row g-3">
          <div class="col-md-12" *ngFor="let project of selectedBranchProjects">
            <div class="project-card h-100">
              <div class="project-header mb-3">
                <div>
                  <h5 class="fw-semibold mb-1">{{ project.title }}</h5>
                  <small class="text-muted">{{ project.managers.length }} Managers ‚Ä¢ {{ project.members.length }} Members</small>
                </div>
                <span class="status-badge" [ngClass]="{
                  'status-new': project.status === 'new',
                  'status-active': project.status === 'active',
                  'status-completed': project.status === 'completed'
                }">
                  {{ project.status | titlecase }}
                </span>
              </div>

              <p class="project-desc text-muted small mb-3">{{ project.description }}</p>

              <div class="d-flex justify-content-between align-items-center mb-3">
                <span class="text-muted small d-flex align-items-center gap-1">
                  <mat-icon fontSize="small" style="color: black;">event</mat-icon>
                  {{ project.start_date | date:'MMM d' }} ‚Üí {{ project.end_date | date:'MMM d' }}
                </span>
                <a *ngIf="project.document" [href]="project.document" target="_blank"
                   class="text-primary small d-flex align-items-center gap-1">
                  <mat-icon fontSize="small" style="color: black;">description</mat-icon> File
                </a>
              </div>

              <details *ngIf="project.tasks?.length" class="task-collapse">
                <summary class="task-summary">
                  <mat-icon>list</mat-icon> Tasks ({{ project.tasks.length }})
                </summary>
                <div class="task-list mt-3">
                  <div class="task-card" *ngFor="let task of project.tasks">
                    <div class="d-flex justify-content-between align-items-start">
                      <div>
                        <h6 class="mb-1">{{ task.title }}</h6>
                        <small class="text-muted">{{ task.start_date | date:'shortDate' }} ‚Üí {{ task.end_date | date:'shortDate' }}</small>
                      </div>
                      <span class="task-status" [class]="task.status">{{ task.status | titlecase }}</span>
                    </div>
                  </div>
                </div>
              </details>
            </div>
          </div>
        </div>
      </div>

      <!-- Company Policies -->
      <div class="dash_policies">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h6 class="section-title">üè¢ Company Policies</h6>
          <span class="text-muted small">Total: {{ selectedBranchPolicies.length }}</span>
        </div>

        <div *ngIf="selectedBranchPolicies.length === 0" class="text-center py-5 text-muted">
          <mat-icon style="font-size: 48px; opacity: 0.3;">policy</mat-icon>
          <h6 class="mt-3">No policies available for the selected branch.</h6>
        </div>

        <div class="row g-4">
          <div class="col-12" *ngFor="let policy of selectedBranchPolicies">
            <div class="policy-card">
              <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                  <h5 class="text-primary fw-semibold mb-2">{{ policy.title }}</h5>
                  <p class="text-muted small mb-3">{{ policy.description }}</p>

                  <div class="d-flex flex-wrap gap-2 mb-3">
                    <span class="badge bg-light text-dark">
                      <mat-icon fontSize="small">groups</mat-icon> {{ policy.department || 'N/A' }}
                    </span>
                    <span class="badge bg-light text-dark">
                      <mat-icon fontSize="small">category</mat-icon> {{ policy.category || 'N/A' }}
                    </span>
                  </div>

                  <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted d-flex align-items-center gap-1">
                      <mat-icon fontSize="small">calendar_today</mat-icon>
                      {{ policy.created_at | date: 'mediumDate' }}
                    </small>

                    <a *ngIf="policy.policy_file" [href]="policy.policy_file" target="_blank"
                       class="btn btn-sm btn-outline-primary d-flex align-items-center gap-1">
                      <mat-icon fontSize="small">description</mat-icon> View
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

        </div>
        

        </div>


      
    


     <!-- Full-Screen Loader -->
     <div class="loader-container" [class.show]="isLoadingEss">
      <div class="loader"></div>
    </div>
