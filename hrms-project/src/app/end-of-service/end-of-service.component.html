<div class="container"  *ngIf="hasViewPermission">
    <div class="comapny_section">
        <div class="com_list " >
            <div class="cpm-sec">
    
                <h2>Employee End of service </h2>
                <hr>
                
                <form (ngSubmit)="GetEndOfService()">
                    <div class="row">
                      <div class="col-md-6">
                        <label>Employee</label>
                        <div class="custom-sel">
                          <select class="form-control" [(ngModel)]="selectedEmployeeId" name="employeeId" required>
                            <option value="">-- Select Employee --</option>
                            <option *ngFor="let approver of EmployeeResignation" [value]="approver.eos_id">
                              {{ approver.employee_name || 'No Name' }} ({{ approver.employee_code }})
                            </option>
                          </select>
                        </div>
                      </div>
                  
                    </div>

                    <div class="row">
                        <div class="col-md-9">
                            
                        </div>
                        
                      <div class="col-md-3 mt-4" *ngIf="hasAddPermission">
                        <button type="submit" class="btn btn-primary pull-right">Get End of Service</button>
                      </div>
                    </div>
                  </form>
                  


            </div>
        </div>

       <div class="com_list mt-5" >
            <div class="cpm-sec">
    
        <!-- Show EOS details -->
<!-- EOS details -->
<div *ngIf="endOfService">
    <div class="row">
      <div class="col-md-8">
        <h4 class="mt-4">End of Service Details</h4>
      </div>
      <div class="col-md-4 text-end">
        <button type="button" class="btn btn-primary" (click)="getFinalSettlement()">
          Get Final Settlement Data
        </button>
      </div>
    </div>
  
    <table class="table table-bordered">
      <tr><th>Employee Code</th><td>{{ endOfService.employee_code }}</td></tr>
      <tr><th>Name</th><td>{{ endOfService.employee_name }}</td></tr>
      <tr><th>Department</th><td>{{ endOfService.department }}</td></tr>
      <tr><th>Date of Joining</th><td>{{ endOfService.date_of_joining }}</td></tr>
      <tr><th>Last Working Date</th><td>{{ endOfService.last_working_date }}</td></tr>
      <tr><th>Status</th><td>{{ endOfService.status }}</td></tr>
      <tr><th>Final Month Salary</th><td>{{ endOfService.final_month_salary }}</td></tr>
      <tr><th>Gratuity Amount</th><td>{{ endOfService.gratuity_amount }}</td></tr>
    </table>
  </div>
  
  <!-- Modal for Final Settlement -->
  <div *ngIf="isFinalSettlementModal" class="modal">
    <div class="modal-content">
      <div class="row">
        <div class="col-md-10">
          <h2>Final Settlement Data</h2>
        </div>
        <div class="col-md-2 text-end">
          <span class="close" (click)="closeFinalSettlementModal()">&times;</span>
        </div>
      </div>
      <hr />
  
      <div *ngIf="finalSettlement" class="final-settlement-report">
        <!-- Company Header -->
        <div class="header text-center mb-3">
          <!-- <h3>MASTER SYSTEMS</h3> -->
          <h4>FINAL SETTLEMENT</h4>
        </div>
      
        <!-- Employee Info -->
        <table class="table table-bordered">
          <tr>
            <th>Code</th>
            <td>{{ finalSettlement.employee.code }}</td>
            <th>Name</th>
            <td>{{ finalSettlement.employee.name }}</td>
          </tr>
          <tr>
            <th>Designation</th>
            <td>{{ finalSettlement.employee.designation }}</td>
            <th>Department</th>
            <td>{{ finalSettlement.employee.department }}</td>
          </tr>
        </table>
      
        <!-- Gratuity Entitlement -->
        <h5 class="mt-3">Gratuity Entitlement</h5>
        <table class="table table-bordered">
          <tr>
            <th>Date of Joining</th>
            <td>{{ finalSettlement.gratuity_entitlement.date_of_joining }}</td>
            <th>Work Status</th>
            <td>{{ finalSettlement.gratuity_entitlement.work_status }}</td>
          </tr>
          <tr>
            <th>Date of Resignation</th>
            <td>{{ finalSettlement.gratuity_entitlement.date_of_resignation_termination }}</td>
            <th>Notice Period Days</th>
            <td>{{ finalSettlement.gratuity_entitlement.notice_period_days }}</td>
          </tr>
          <tr>
            <th>Last Working Date</th>
            <td>{{ finalSettlement.gratuity_entitlement.last_working_date }}</td>
            <th>Total Service Days</th>
            <td>{{ finalSettlement.gratuity_entitlement.total_service_days }}</td>
          </tr>
          <tr>
            <th>Leave Days Without Pay</th>
            <td>{{ finalSettlement.gratuity_entitlement.leave_days_without_pay }}</td>
            <th>Net Days Worked</th>
            <td>{{ finalSettlement.gratuity_entitlement.net_days_worked }}</td>
          </tr>
          <tr>
            <th>Basic Salary</th>
            <td>{{ finalSettlement.gratuity_entitlement.basic_salary }}</td>
            <th>Gratuity Days</th>
            <td>{{ finalSettlement.gratuity_entitlement.gratuity_days }}</td>
          </tr>
          <tr>
            <th>Last Month Salary</th>
            <td>{{ finalSettlement.gratuity_entitlement.last_month_salary }}</td>
          </tr>
        </table>
      
        <!-- Payslip Summary -->
        <h5 class="mt-3">Payslip Summary</h5>
<table class="table table-bordered payslip-summary-table">
  <thead>
    <tr>
      <th>Particulars</th>
      <th>Deductions</th>
      <th>Additions</th>
    </tr>
  </thead>
  <tbody>
    <tr data-label="Particulars" *ngFor="let d of finalSettlement.payslip_summary.deductions">
      <td>{{ d.component_name }}</td>
      <td>{{ d.amount }}</td>
      <td>0.00</td>
    </tr>
    <tr data-label="Additions" *ngFor="let a of finalSettlement.payslip_summary.additions">
      <td>{{ a.component_name }}</td>
      <td>0.00</td>
      <td>{{ a.amount }}</td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <th>Total</th>
      <td>{{ finalSettlement.payslip_summary.total_deductions }}</td>
      <td>{{ finalSettlement.payslip_summary.total_additions }}</td>
    </tr>
    <tr>
      <th colspan="2">Net Amount (AED)</th>
      <td>{{ finalSettlement.payslip_summary.net_amount }}</td>
    </tr>
  </tfoot>
</table>

      
        <!-- Footer -->
        <div class="mt-3">
          <p><strong>Status:</strong> {{ finalSettlement.status }}</p>
          <p><strong>Processed Date:</strong> {{ finalSettlement.processed_date }}</p>
         
        </div>
      

      </div>
      
    </div>
  </div>
  
             
        </div>
    </div>
</div>