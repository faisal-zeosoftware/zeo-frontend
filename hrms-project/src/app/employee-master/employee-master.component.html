<div class="container" *ngIf="hasViewPermission">
    <div class="comapny_section">
        <div class="header_section">

            <div class="row">
                <div class="col-md-3">
                    <h1> Employees </h1>
                </div>

                <div class="col-md-3">
                    <div class="input-group serarch_Sec mt-1">
                      <input 
                        type="text" 
                        class="form-control" 
                        [placeholder]="searchPlaceholder" 
                        [(ngModel)]="searchQuery" 
                        (input)="filterEmployees()"
                      >
                      <div class="search_op" title="Search" (click)="filterEmployees()">
                        <mat-icon >filter_alt</mat-icon>
                      </div>
                    </div>
                    <div class="ser_sub" *ngIf="serSubSec">
                      <div *ngIf="showSearchOptions">
                        <div class="input-group serarch_Sec mt-2">
                          <select 
                            class="form-control" 
                            [(ngModel)]="searchType" 
                            (change)="onSearchTypeChange()"
                          >
                            <option value="test">Select</option>
                            <option value="name">Search by Name</option>
                            <option value="code">Search by Code</option>
                            <option value="Branch">Search by Branch</option>
                            <option value="Department">Search by Department</option>
                            <option value="Designation">Search by Designation</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                    


                <div class="col-md-6">
                    <div class="button-group pull-right"  *ngIf="!hideButton">
                        <button type="button"  class="btn-Create  btn btn-success "  (click)="openPopus()" *ngIf="hasAddPermission"> <span class="header-btn-icon"><mat-icon>add_circle
                        </mat-icon></span> Create</button>
                        <span *ngIf="!hasAddPermission"></span>

                        <button type="button" class="btn-Edit btn-info btn"  (click)="EditShowButtons()" *ngIf="hasEditPermission">
                            <span class="header-btn-icon">
                             <mat-icon>draw
                        </mat-icon></span> Edit</button>
               

                        <span *ngIf="hasEditPermission"></span>

                        <button type="button" class="btn-Delete btn btn-danger" (click)="toggleCheckboxes()"  *ngIf="hasDeletePermission">
                            <span class="header-btn-icon">
                                <mat-icon> delete
                           </mat-icon></span> {{ Delete ? 'Cancel' : 'Delete' }}</button>



                           <span *ngIf="!hasDeletePermission"></span>

                           <button type="button" class="btn-Edit btn-secondary  btn"  (click)="OpenBulkuploadModal()" *ngIf="hasEditPermission">
                            <span class="header-btn-icon">
                             <mat-icon>system_update_alt
                        </mat-icon></span> Import</button>
                    </div>

                </div>
                
            </div>
           
           

        </div>

       
        <div class="row">
            <div class="col-md-2">
                
                <button  class=" mt-3 btn-danger btn " style="width: 100%;" color="warn" *ngIf="Delete" (click)="toggleSelectAllEmployees()">Select All</button>

            </div>
            <div class="col-md-3">
                <button class=" mt-3 btn-danger btn"  color="warn" *ngIf="Delete" (click)="deleteSelectedEmployees()">Delete Selected Employees</button>

            </div>
        </div>

            

<!-- Toggle Button -->
 <div class="row">
    <div class="col-md-12">
     <!-- Toggle Button -->
<button class="pull-right btn-gridview mt-2" mat-raised-button color="primary" (click)="toggleView()">
    <mat-icon>{{ isTableView ? 'view_module' : 'table_chart' }}</mat-icon>
 
  </button>
  
    </div>

    
 </div>



        <div class="row mt-4" *ngIf="!isTableView">
         
          <div class="col-md-4" *ngFor="let employeesec of filteredEmployees">
            <div class="emp-card-modern mt-3" [ngClass]="{ 'selected-card': employeesec.selected }">
              
              <mat-checkbox *ngIf="Delete" class="card-selection-check" 
                            [(ngModel)]="employeesec.selected" 
                            (change)="onCheckboxChange(employeesec.id)">
              </mat-checkbox>
          
              <div class="card-content">
                <div class="row align-items-center">
                  
                  <div class="col-4">
                    <div class="profile-wrapper">
                      <img [src]="employeesec.emp_profile_pic || 'assets/default-avatar.png'" 
                           alt="Employee" class="emp-avatar">
                      
                      <button mat-mini-fab color="primary" class="edit-overlay-btn" 
                              (click)="openEditEmpPopuss(employeesec.id)" *ngIf="showEditBtn">
                        <mat-icon>edit</mat-icon>
                      </button>
                    </div>
                  </div>
          
                  <div class="col-8" (click)="showEmployeeDetails(employeesec.id)" style="cursor: pointer;">
                    <div class="emp-info">
                      <h2 class="emp-name">{{ employeesec.emp_first_name }} {{ employeesec.emp_last_name }}</h2>
                      <div class="emp-badge">
                         <span class="label">ID:</span>
                         <span class="value">{{ employeesec.emp_code }}</span>
                      </div>
                    </div>
                  </div>
          
                </div>
              </div>
            </div>
          </div>


            

        </div>
      
<!-- Table View -->

<div class="mt-4" *ngIf="isTableView">
    <div class="tabe_outer">
      <div class="row mb-3">
        <div class="col-md-3 "></div>
        <div class="col-md-3 col-6">
            <mat-form-field appearance="outline" class="w-100 custom-branch-select">
                <mat-select placeholder="Select Branches"
                            multiple
                            [(value)]="selectedBranches"
                            (selectionChange)="onBranchSelectionChange()">
              
                  <!-- ✅ Select All option -->
                  <mat-option (click)="toggleAllBranches()" [value]="'all'">
                    <mat-pseudo-checkbox 
                        class="mat-option-pseudo-checkbox"
                        [state]="isAllSelected() ? 'checked' : (selectedBranches.length > 0 ? 'indeterminate' : 'unchecked')">
                    </mat-pseudo-checkbox>
                    Select All
                  </mat-option>
              
                  <mat-option *ngFor="let branch of branches" [value]="branch.branch_name">
                    {{ branch.branch_name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              
              
              
              
        </div>

     

        <div class="col-md-3 col-6">
            <mat-form-field appearance="outline" class="w-100 custom-branch-select">
                <mat-select placeholder="Select Department "
                            multiple
                            [(value)]="selectedDepartment"
                            (selectionChange)="onDepartmentSelectionChange()">
              
                  <!-- ✅ Select All option -->
                  <mat-option (click)="toggleAllDepartment()" [value]="'all'">
                    <mat-pseudo-checkbox 
                        class="mat-option-pseudo-checkbox"
                        [state]="isAllSelectedDepartment() ? 'checked' : (selectedDepartment.length > 0 ? 'indeterminateDepartment' : 'uncheckedDepartment')">
                    </mat-pseudo-checkbox>
                    Select All
                  </mat-option>
              
                  <mat-option *ngFor="let branch of departments" [value]="branch.dept_name">
                    {{ branch.dept_name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              
              
              
              
        </div>


        <div class="col-md-3 col-6">
            <mat-form-field appearance="outline" class="w-100 custom-branch-select">
                <mat-select placeholder="Select Designation "
                            multiple
                            [(value)]="selectedDesignations"
                            (selectionChange)="onDesignationsSelectionChange()">
              
                  <!-- ✅ Select All option -->
                  <mat-option (click)="toggleAllDesignations()" [value]="'all'">
                    <mat-pseudo-checkbox 
                        class="mat-option-pseudo-checkbox"
                        [state]="isAllSelectedDesignations() ? 'checkedDesignations' : (selectedDesignations.length > 0 ? 'indeterminateDesignations' : 'uncheckedDesignations')">
                    </mat-pseudo-checkbox>
                    Select All
                  </mat-option>
              
                  <mat-option *ngFor="let branch of Designations" [value]="branch.desgntn_job_title">
                    {{ branch.desgntn_job_title }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              
              
              
              
        </div>
      
      </div>
  
      <table class="table  table-striped">
        <thead>
          <tr>
            <th>Profile</th>
            <th>Employee Code</th>
            <th>Name</th>
            <th>Branch</th>
            <th>Department</th>
            <th>Category</th>
            <th>Designation</th>
            <th>Active</th>
            <th *ngIf="showEditBtn">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let emp of filteredEmployees" (click)="showEmployeeDetails(emp.id)">
            <td>
              <img [src]="emp.emp_profile_pic" alt="Profile"
                   style="width: 40px; height: 40px; border-radius: 50%;">
            </td>
            <td>{{ emp.emp_code }}</td>
            <td>{{ emp.emp_first_name }} {{ emp.emp_last_name }}</td>
            <td>{{ emp.emp_branch_id }}</td>
            <td>{{ emp.emp_dept_id }}</td>
            <td>{{ emp.emp_ctgry_id }}</td>
            <td>{{ emp.emp_desgntn_id }}</td>
            <td>{{ emp.is_active ? 'Yes' : 'No' }}</td>
            <td *ngIf="showEditBtn">
              <button mat-icon-button color="primary" (click)="openEditEmpPopuss(emp.id)">
                <mat-icon>edit</mat-icon>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  
    </div>
</div>


  <!-- Modal Popup for selected approval details -->
  <div *ngIf="isBulkuploadEmployeeModalOpen" class="modal">

    <div class="modal-content">

       

        <div class="row">
            <div class="col-md-8">
                <h2>Employee Bulk Upload & Download Details</h2> 
            </div>
            <div class="col-md-4">
                <span class="close pull-right" (click)="closeBulkuploadModal()">&times;</span>

            </div>
        </div><hr>


        <div class="row mt-4">
            <div class="col-md-4">
                <div class="vn-wisteria" >
                    <a  class="btn-wrap" (click)="downloadEmployeeExcel()">DOWNLOAD EXCEL FILE <i class="fa fa-rocket fa-lg fa-spin"></i></a>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="vn-wisteria vn-green" >
                        <a  class="btn-wrap"  (click)="downloadEmployeeCsv()">DOWNLOAD CSV FILE <i class="fa fa-rocket fa-lg fa-spin"></i></a>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="vn-wisteria  vn-blue" >
                            <a class="btn-wrap" (click)="toggleUploadForm()">
                                EMPLOYEE BULK UPLOAD <i class="fa fa-rocket fa-lg fa-spin"></i>
                              </a>                            </div>
                        </div>
            </div>

          <!-- Upload Form (shown only when showUploadForm = true) -->
<div *ngIf="showUploadForm">
    <form (ngSubmit)="bulkuploaddocument()" #documentForm="ngForm">
      <div class="row">
        <div class="col-md-12">
          <label for="emp_profile_pic">Upload Employee Details:</label>
          <input
            type="file"
            accept=".xlsx"
            class="form-control"
            id="file"
            name="myfile"
            (change)="onFileSelect($event)"
            #UploadFileInput
          />
        </div>
      </div>
  
      <div class="row mt-3">
        <div class="col-md-8"></div>
        <div class="col-md-2 col-6">
            <button type="button" mat-raised-button color="warn"   class="pull-right btn-danger btn-full"  (click)="closeUploadForm()">
              close
            </button>
          </div>
        
        <div class="col-md-2 col-6">
          <button type="submit" mat-raised-button color="primary" class="pull-right btn-full">
            Save
          </button>
        </div>

        
      </div>
      

    </form>
  </div>

            
   
    
    

    </div>
  </div>


<div *ngIf="!hasViewPermission">
    <!-- Message for users without permission -->
    <p class="text-center " style="margin-top: 150px;" >You don't have permission to view this component.</p>
  </div>

     <!-- Loader -->
     <div class="loader-container" [class.show]="isLoading">
        <div class="loader"></div>
      </div>



      
