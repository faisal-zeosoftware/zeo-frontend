<div class="container" *ngIf="hasViewPermission">
    <div class="comapny_section">
    
        <div class="com_list mt-4 " >
          <div class="cpm-sec p-3 shadow-sm bg-white rounded border">
            <div class="d-flex justify-content-between align-items-center">
              <h2 class="h4">Attendance Report Employee</h2>
              <div class="exportdownload" *ngIf="hasExportPermission">
              <button class="btn btn-success" *ngIf="filteredRecords.length > 0" (click) ="exportToExcel()">
                <i class="fas fa-file-excel mr-2"></i> Export to Excel
              </button>
              </div>
            </div>
            <hr>
          
            <div class="row mb-3 bg-light p-3 mx-0 rounded">
              <div class="col-md-4">
                <label class="small font-weight-bold">Start Date</label>
                <input type="date" class="form-control" [(ngModel)]="start_date" />
              </div>
              <div class="col-md-4">
                <label class="small font-weight-bold">End Date</label>
                <input type="date" class="form-control" [(ngModel)]="end_date" />
              </div>
              <div class="col-md-4 mt-4" *ngIf="hasAddPermission">
                <button 
                  class="btn btn-primary w-100 mt-1 shadow-sm mt-4" 
                  (click)="generateAttendanceReport()" 
                  [disabled]="isLoading">
                  
                  <span *ngIf="isLoading">
                    <span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>
                    Generating...
                  </span>
              
                  <span *ngIf="!isLoading">
                    <i class="fas fa-sync-alt mr-2"></i> Generate Report
                  </span>
                  
                </button>
              </div>
            </div>
          
            <div class="row mb-4" *ngIf="allAttendanceRecords.length > 0">
             
              <div class="col-md-3">
                <label class="small font-weight-bold">Branch</label>
                <select class="form-control" [(ngModel)]="selectedBranch" (change)="applyLocalFilters()">
                  <option value="">All Branches</option>
                  <option *ngFor="let b of uniqueBranches" [value]="b">{{b}}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="small font-weight-bold">Dept</label>
                <select class="form-control" [(ngModel)]="selectedDept" (change)="applyLocalFilters()">
                  <option value="">All Depts</option>
                  <option *ngFor="let d of uniqueDepts" [value]="d">{{d}}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="small font-weight-bold">Desg</label>
                <select class="form-control" [(ngModel)]="selectedDesg" (change)="applyLocalFilters()">
                  <option value="">All Desg</option>
                  <option *ngFor="let ds of uniqueDesgs" [value]="ds">{{ds}}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="small font-weight-bold">Search Employee</label>
                <input type="text" class="form-control" placeholder="Search by name..." 
                       [(ngModel)]="searchText" (input)="applyLocalFilters()">
              </div>
            </div>
          
            <div class="table-responsive" *ngIf="filteredRecords.length > 0">
              <table class="table table-sm table-bordered">
                <thead class="bg-dark text-white">
                  <tr>
                    <th>Employee</th>
                    <th>Branch/Dept</th>
                    <th>Date</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <ng-container *ngFor="let emp of filteredRecords">
                    <tr *ngFor="let day of emp.attendance.summary_data">
                      <td><strong>{{ emp.employee_name }}</strong></td>
                      <td><small>{{ emp.branch }} / {{ emp.department || 'N/A' }}</small></td>
                      <td>{{ day.date | date:'dd-MM-yyyy' }}</td>
                      <td>
                        <span [class.text-success]="day.status === 'Present'" 
                              [class.text-danger]="day.status === 'Absent'">
                          {{ day.status }}
                        </span>
                      </td>
                    </tr>
                  </ng-container>
                </tbody>
              </table>
            </div>
          </div>
        </div>






    </div>
</div>